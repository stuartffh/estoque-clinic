<div class="clinic-list-container">
  <p-card header="Gestão de Clínicas" class="clinic-card">
    
    <!-- Toolbar -->
    <p-toolbar class="clinic-toolbar">
      <div class="p-toolbar-group-left">
        <h2 class="toolbar-title">Clínicas do Grupo</h2>
      </div>
      
      <div class="p-toolbar-group-right">
        <button 
          pButton 
          type="button" 
          label="Nova Clínica" 
          icon="pi pi-plus" 
          class="p-button-primary"
          (click)="openNewClinicDialog()"
          *ngIf="canEdit()">
        </button>
      </div>
    </p-toolbar>

    <!-- Search and Filters -->
    <div class="search-filters">
      <div class="p-grid p-align-center">
        <div class="p-col-12 p-md-6">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
              type="text" 
              pInputText 
              placeholder="Buscar clínicas..." 
              [(ngModel)]="searchTerm"
              (keyup.enter)="search()"
              class="search-input">
          </span>
          <button 
            pButton 
            type="button" 
            icon="pi pi-search" 
            class="p-button-outlined search-btn"
            (click)="search()">
          </button>
        </div>
        
        <div class="p-col-12 p-md-3">
          <p-dropdown 
            [options]="filterOptions" 
            [(ngModel)]="isActiveFilter"
            placeholder="Status"
            optionLabel="label"
            optionValue="value"
            (onChange)="search()">
          </p-dropdown>
        </div>
        
        <div class="p-col-12 p-md-3">
          <span class="total-items">
            Total: {{ totalItems }} clínicas
          </span>
        </div>
      </div>
    </div>

    <!-- Clinics Table -->
    <p-table 
      [value]="clinics" 
      [loading]="loading"
      [paginator]="true"
      [rows]="itemsPerPage"
      [totalRecords]="totalItems"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      responsiveLayout="scroll"
      class="clinics-table">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>Localização</th>
          <th>Contato</th>
          <th>Estatísticas</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-clinic>
        <tr>
          <td>
            <div class="clinic-name">
              <strong>{{ clinic.name }}</strong>
              <small *ngIf="clinic.cro_number">CRO: {{ clinic.cro_number }}</small>
            </div>
          </td>
          
          <td>
            <span *ngIf="clinic.cnpj">{{ formatCNPJ(clinic.cnpj) }}</span>
            <span *ngIf="!clinic.cnpj" class="text-muted">Não informado</span>
          </td>
          
          <td>
            <div class="location-info" *ngIf="clinic.address_city">
              <i class="pi pi-map-marker"></i>
              {{ clinic.address_city }}/{{ clinic.address_state }}
            </div>
            <span *ngIf="!clinic.address_city" class="text-muted">Não informado</span>
          </td>
          
          <td>
            <div class="contact-info">
              <div *ngIf="clinic.phone">
                <i class="pi pi-phone"></i>
                {{ formatPhone(clinic.phone) }}
              </div>
              <div *ngIf="clinic.email">
                <i class="pi pi-envelope"></i>
                {{ clinic.email }}
              </div>
              <span *ngIf="!clinic.phone && !clinic.email" class="text-muted">Não informado</span>
            </div>
          </td>
          
          <td>
            <div class="stats-info">
              <p-tag 
                [value]="clinic.users_count + ' usuários'" 
                severity="info" 
                icon="pi pi-users"
                class="stat-tag">
              </p-tag>
              <p-tag 
                [value]="clinic.batches_count + ' lotes'" 
                severity="warning" 
                icon="pi pi-box"
                class="stat-tag">
              </p-tag>
              <p-tag 
                [value]="clinic.professionals_count + ' profissionais'" 
                severity="success" 
                icon="pi pi-user-plus"
                class="stat-tag">
              </p-tag>
            </div>
          </td>
          
          <td>
            <p-tag 
              [value]="getStatusLabel(clinic.is_active)"
              [severity]="getSeverity(clinic.is_active)">
            </p-tag>
          </td>
          
          <td>
            <div class="action-buttons">
              <button 
                pButton 
                type="button" 
                icon="pi pi-eye" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Visualizar"
                tooltipPosition="top"
                (click)="viewClinic(clinic)">
              </button>
              
              <button 
                pButton 
                type="button" 
                icon="pi pi-pencil" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Editar"
                tooltipPosition="top"
                (click)="editClinic(clinic)"
                *ngIf="canEdit()">
              </button>
              
              <button 
                pButton 
                type="button" 
                icon="pi pi-trash" 
                class="p-button-rounded p-button-text p-button-danger p-button-sm"
                pTooltip="Desativar"
                tooltipPosition="top"
                (click)="deleteClinic(clinic)"
                *ngIf="canDelete() && clinic.is_active">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">
            <div class="empty-state">
              <i class="pi pi-building empty-icon"></i>
              <h3>Nenhuma clínica encontrada</h3>
              <p>Não há clínicas cadastradas ou que atendam aos filtros aplicados.</p>
              <button 
                pButton 
                type="button" 
                label="Cadastrar Primeira Clínica" 
                icon="pi pi-plus"
                class="p-button-primary"
                (click)="openNewClinicDialog()"
                *ngIf="canEdit() && clinics.length === 0">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Clinic Form Dialog -->
  <p-dialog 
    [(visible)]="showDialog" 
    [header]="isEditMode ? 'Editar Clínica' : 'Nova Clínica'"
    [modal]="true"
    [closable]="true"
    [responsive]="true"
    [style]="{width: '600px'}"
    class="clinic-dialog">
    
    <form #clinicFormRef="ngForm">
      <div class="p-grid">
        <!-- Nome -->
        <div class="p-col-12">
          <label for="name" class="form-label required">Nome da Clínica</label>
          <input 
            type="text" 
            id="name"
            pInputText 
            [(ngModel)]="clinicForm.name"
            name="name"
            #nameField="ngModel"
            required
            class="form-control"
            placeholder="Digite o nome da clínica">
          <small *ngIf="nameField.invalid && nameField.touched" class="p-error">
            Nome é obrigatório
          </small>
        </div>

        <!-- CNPJ e CRO -->
        <div class="p-col-12 p-md-6">
          <label for="cnpj" class="form-label">CNPJ</label>
          <input 
            type="text" 
            id="cnpj"
            pInputText 
            [(ngModel)]="clinicForm.cnpj"
            name="cnpj"
            class="form-control"
            placeholder="00.000.000/0000-00">
        </div>

        <div class="p-col-12 p-md-6">
          <label for="cro_number" class="form-label">Número CRO</label>
          <input 
            type="text" 
            id="cro_number"
            pInputText 
            [(ngModel)]="clinicForm.cro_number"
            name="cro_number"
            class="form-control"
            placeholder="CRO 12345">
        </div>

        <!-- Endereço -->
        <div class="p-col-12">
          <h4 class="form-section-title">Endereço</h4>
        </div>

        <div class="p-col-12 p-md-8">
          <label for="address_street" class="form-label">Logradouro</label>
          <input 
            type="text" 
            id="address_street"
            pInputText 
            [(ngModel)]="clinicForm.address_street"
            name="address_street"
            class="form-control"
            placeholder="Rua, Avenida, etc.">
        </div>

        <div class="p-col-12 p-md-4">
          <label for="address_number" class="form-label">Número</label>
          <input 
            type="text" 
            id="address_number"
            pInputText 
            [(ngModel)]="clinicForm.address_number"
            name="address_number"
            class="form-control"
            placeholder="123">
        </div>

        <div class="p-col-12 p-md-6">
          <label for="address_complement" class="form-label">Complemento</label>
          <input 
            type="text" 
            id="address_complement"
            pInputText 
            [(ngModel)]="clinicForm.address_complement"
            name="address_complement"
            class="form-control"
            placeholder="Sala, Andar, etc.">
        </div>

        <div class="p-col-12 p-md-6">
          <label for="address_neighborhood" class="form-label">Bairro</label>
          <input 
            type="text" 
            id="address_neighborhood"
            pInputText 
            [(ngModel)]="clinicForm.address_neighborhood"
            name="address_neighborhood"
            class="form-control"
            placeholder="Nome do bairro">
        </div>

        <div class="p-col-12 p-md-5">
          <label for="address_city" class="form-label">Cidade</label>
          <input 
            type="text" 
            id="address_city"
            pInputText 
            [(ngModel)]="clinicForm.address_city"
            name="address_city"
            class="form-control"
            placeholder="Nome da cidade">
        </div>

        <div class="p-col-12 p-md-3">
          <label for="address_state" class="form-label">Estado</label>
          <p-dropdown 
            [options]="stateOptions" 
            [(ngModel)]="clinicForm.address_state"
            name="address_state"
            placeholder="UF"
            optionLabel="label"
            optionValue="value"
            class="form-control">
          </p-dropdown>
        </div>

        <div class="p-col-12 p-md-4">
          <label for="address_zipcode" class="form-label">CEP</label>
          <input 
            type="text" 
            id="address_zipcode"
            pInputText 
            [(ngModel)]="clinicForm.address_zipcode"
            name="address_zipcode"
            class="form-control"
            placeholder="00000-000">
        </div>

        <!-- Contato -->
        <div class="p-col-12">
          <h4 class="form-section-title">Contato</h4>
        </div>

        <div class="p-col-12 p-md-6">
          <label for="phone" class="form-label">Telefone</label>
          <input 
            type="text" 
            id="phone"
            pInputText 
            [(ngModel)]="clinicForm.phone"
            name="phone"
            class="form-control"
            placeholder="(11) 99999-9999">
        </div>

        <div class="p-col-12 p-md-6">
          <label for="email" class="form-label">Email</label>
          <input 
            type="email" 
            id="email"
            pInputText 
            [(ngModel)]="clinicForm.email"
            name="email"
            class="form-control"
            placeholder="contato@clinica.com">
        </div>

        <div class="p-col-12">
          <label for="website" class="form-label">Website</label>
          <input 
            type="url" 
            id="website"
            pInputText 
            [(ngModel)]="clinicForm.website"
            name="website"
            class="form-control"
            placeholder="https://www.clinica.com">
        </div>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <button 
        pButton 
        type="button" 
        label="Cancelar" 
        icon="pi pi-times"
        class="p-button-text"
        (click)="showDialog = false">
      </button>
      <button 
        pButton 
        type="button" 
        [label]="isEditMode ? 'Atualizar' : 'Criar'" 
        icon="pi pi-check"
        class="p-button-primary"
        (click)="saveClinic()"
        [disabled]="clinicFormRef.invalid">
      </button>
    </ng-template>
  </p-dialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
  
  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>